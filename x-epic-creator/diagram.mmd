%% x-epic-creator: Epic Creator
%% Decomposes scope into 3-7 Epics through sequential loop
%% Batch Mode only

graph TD
    Start([Start: Create Epics]) --> Phase1[Phase 1: Discovery<br/>Auto-discover Team ID + Next Epic Number]

    Phase1 --> Phase2[Phase 2: Scope Analysis<br/>Identify 3-7 logical domains]

    Phase2 --> Phase3[Phase 3: Sequential Processing Loop<br/>FOR EACH domain]

    subgraph Loop [Sequential Loop - One Epic at a Time]
        Ask[Ask 5 questions:<br/>1. Goal<br/>2. Scope In/Out<br/>3. Success Criteria<br/>4. Risks<br/>5. Phases]

        Ask --> Generate[Generate Epic markdown]
        Generate --> Preview[Show preview to user]
        Preview --> UserConfirm{User types<br/>'confirm'?}
        UserConfirm -->|No| Ask
        UserConfirm -->|Yes| CreateLinear[Create Linear Project]
        CreateLinear --> UpdateKanban[Update kanban_board.md<br/>Increment Next Epic Number by 1]
    end

    Phase3 --> Ask
    UpdateKanban --> MoreDomains{More domains<br/>to process?}
    MoreDomains -->|Yes| Ask
    MoreDomains -->|No| Complete

    Complete[All Epics Created<br/>Display summary]
    Complete --> End([End])

    %% Styling
    classDef discovery fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef loop fill:#FFF9C4,stroke:#F57C00,stroke-width:2px
    classDef decision fill:#FFE0B2,stroke:#E64A19,stroke-width:2px
    classDef action fill:#C8E6C9,stroke:#388E3C,stroke-width:2px

    class Phase1,Phase2 discovery
    class Phase3,Ask,Generate,Preview,CreateLinear,UpdateKanban loop
    class UserConfirm,MoreDomains decision
    class Complete action
